<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TPS â€“ Travel Personal Secretary</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a3d 100%);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(15, 15, 35, 0.2);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(79, 70, 229, 0.5);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(79, 70, 229, 0.7);
        }

        .app-container {
            display: flex;
            min-height: 100vh;
        }

        .connection-status {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(47, 46, 92, 0.9);
            border-radius: 8px;
            padding: 8px 12px;
            font-size: 11px;
            z-index: 1001;
            color: #00ff88;
        }

        .sidebar {
            width: 320px;
            background: linear-gradient(180deg, rgba(10, 10, 20, 0.98) 0%, rgba(15, 15, 25, 0.98) 100%);
            padding: 20px;
            display: flex;
            flex-direction: column;
            border-right: 1px solid rgba(58, 58, 109, 0.5);
            overflow-y: auto;
            height: 100vh;
            position: sticky;
            top: 0;
        }

        .language-selector {
            background: rgba(47, 46, 92, 0.9);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 30px;
            text-align: center;
        }

        .language-selector h3 {
            font-size: 14px;
            color: #888;
            margin-bottom: 12px;
        }

        .language-selector select {
            background: rgba(26, 26, 46, 0.8);
            border: 2px solid rgba(79, 70, 229, 0.4);
            color: white;
            padding: 10px 15px;
            font-size: 14px;
            cursor: pointer;
            outline: none;
            border-radius: 8px;
            width: 100%;
        }

        .language-selector select option {
            background: #2f2e5c;
            color: white;
        }

        .sidebar h2 {
            font-size: 18px;
            margin-bottom: 20px;
            color: #888;
            text-align: center;
            border-bottom: 2px solid rgba(58, 58, 109, 0.5);
            padding-bottom: 20px;
        }

        .sidebar-message {
            font-size: 14px;
            color: #ffd700;
            text-align: center;
            line-height: 1.6;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 215, 0, 0.1);
            border-radius: 15px;
            border: 1px solid rgba(255, 215, 0, 0.2);
        }

        .destinations-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 18px;
            margin-bottom: 25px;
        }

        .destination-item {
            transition: all 0.4s ease;
            border-radius: 15px;
            overflow: hidden;
            background: linear-gradient(135deg, rgba(20, 20, 30, 0.8), rgba(15, 15, 25, 0.8));
            position: relative;
            opacity: 0.8;
            cursor: pointer;
        }

        .destination-item:hover {
            opacity: 1;
            transform: translateY(-2px);
        }

        .destination-item img {
            width: 100%;
            height: 100px;
            object-fit: cover;
            filter: brightness(0.6);
        }

        .destination-item:hover img {
            filter: brightness(0.7);
        }

        .destination-item span {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 12px 8px;
            font-size: 13px;
            font-weight: 600;
            text-align: center;
            background: linear-gradient(to top, rgba(0,0,0,0.95), transparent);
            color: white;
        }

        .sidebar-footer {
            margin-top: auto;
            font-size: 11px;
            color: rgba(170, 170, 170, 0.7);
            text-align: center;
            padding: 20px 0 10px;
            border-top: 1px solid rgba(58, 58, 109, 0.3);
        }

        .main {
            flex: 1;
            background: #000;
            position: relative;
            display: flex;
            flex-direction: column;
            padding: 60px 20px 20px;
            min-height: 100vh;
        }

        .logo-container {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1002;
        }

        .logo {
            font-size: 36px;
            font-weight: bold;
            color: #3fa3ff;
            text-shadow: 0 0 25px rgba(63, 163, 255, 0.6);
            animation: logoGlow 3s ease-in-out infinite alternate;
            text-align: center;
        }

        @keyframes logoGlow {
            from { text-shadow: 0 0 25px rgba(63, 163, 255, 0.6); }
            to { text-shadow: 0 0 35px rgba(63, 163, 255, 0.8), 0 0 50px rgba(63, 163, 255, 0.4); }
        }

        .header-tabs {
            position: absolute;
            top: 100px;
            right: 20px;
            left: 20px;
            display: flex;
            gap: 8px;
            z-index: 10;
            flex-wrap: wrap;
            justify-content: center;
        }

        .tab-button {
            background: linear-gradient(135deg, #4f46e5, #6366f1);
            border: none;
            color: white;
            padding: 10px 14px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 90px;
            flex: 1;
            max-width: 120px;
        }

        .tab-button:hover {
            transform: translateY(-3px) scale(1.05);
        }

        .tab-button.active {
            background: linear-gradient(135deg, #3b36c8, #4f46e5);
            transform: translateY(-2px);
        }

        .chat-container {
            flex: 1;
            background: transparent;
            padding: 0 20px;
            overflow-y: auto;
            max-width: 1000px;
            margin: 0 auto;
            width: 100%;
            position: absolute;
            top: 220px;
            bottom: 120px;
            left: 50%;
            transform: translateX(-50%);
            padding-bottom: 40px;
        }

        .conversation-line {
            width: 100%;
            margin-bottom: 25px;
            line-height: 1.6;
            font-size: 15px;
            word-wrap: break-word;
            display: flex;
            align-items: flex-start;
            gap: 15px;
            animation: fadeInUp 0.5s ease forwards;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .conversation-line.user {
            color: #b8c5ff;
        }

        .conversation-line.assistant {
            color: #ffd700;
            margin-bottom: 30px;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            flex-shrink: 0;
            margin-top: 4px;
        }

        .conversation-line.user .message-avatar {
            background: linear-gradient(135deg, #4f46e5, #6366f1);
        }

        .conversation-line.assistant .message-avatar {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #1a1a2e;
        }

        .message-content {
            flex: 1;
            padding: 0;
            background: transparent;
        }

        .message-header {
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .conversation-line.user .message-header {
            color: #6366f1;
        }

        .conversation-line.assistant .message-header {
            color: #ffd700;
        }

        .message-text {
            line-height: 1.6;
        }

        .input-container {
            position: fixed;
            bottom: 20px;
            left: 340px;
            right: 20px;
            display: flex;
            gap: 0;
            z-index: 9999;
            background: rgba(0, 0, 0, 0.99);
            padding: 8px;
            border-radius: 18px;
            border: 1px solid rgba(79, 70, 229, 0.4);
        }

        .message-input {
            flex: 1;
            padding: 14px 18px;
            min-height: 50px;
            max-height: 100px;
            resize: none;
            border: 2px solid #4f46e5;
            border-radius: 14px 0 0 14px;
            background: rgba(26, 26, 46, 0.98);
            color: white;
            font-size: 15px;
            font-family: inherit;
            line-height: 1.4;
            outline: none;
        }

        .message-input:focus {
            border-color: #6d63ff;
        }

        .message-input::placeholder {
            color: #888;
        }

        .send-button {
            width: 90px;
            background: linear-gradient(135deg, #4f46e5, #6d63ff);
            border: none;
            border-radius: 0 14px 14px 0;
            color: white;
            font-weight: bold;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .send-button:hover {
            transform: translateY(-2px);
        }

        .send-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                height: auto;
                order: 2;
                padding: 20px 15px;
                position: relative;
                max-height: 50vh;
            }

            .destinations-grid {
                grid-template-columns: 1fr 1fr 1fr;
                gap: 12px;
            }

            .destination-item img {
                height: 70px;
            }

            .main {
                order: 1;
                padding: 80px 15px 20px;
                min-height: 60vh;
            }

            .input-container {
                left: 15px;
                right: 15px;
                bottom: 15px;
            }

            .chat-container {
                position: absolute;
                top: 200px;
                bottom: 100px;
                left: 15px;
                right: 15px;
                transform: none;
                padding: 0 15px;
                margin: 0;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="connection-status">ğŸŸ¢ Online</div>

        <div class="sidebar">
            <!-- SELETOR DE IDIOMAS -->
            <div class="language-selector">
                <h3 id="languageTitle">ğŸŒ Language / Idioma</h3>
                <select id="languageSelect">
                    <option value="en">ğŸ‡ºğŸ‡¸ English</option>
                    <option value="pt">ğŸ‡§ğŸ‡· PortuguÃªs</option>
                    <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
                    <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
                    <option value="de">ğŸ‡©ğŸ‡ª Deutsch</option>
                    <option value="it">ğŸ‡®ğŸ‡¹ Italiano</option>
                    <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
                    <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option>
                    <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
                    <option value="ru">ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
                    <option value="ar">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                    <option value="hi">ğŸ‡®ğŸ‡³ à¤¹à¤¿à¤¨à¥à¤¦à¥€</option>
                </select>
            </div>

            <h2 id="sidebarTitle">ğŸ§­ Destinations that Touch the Soul</h2>
            
            <div class="sidebar-message" id="sidebarMessage">
                ğŸŒ± Every journey through TPS plants hope and transforms lives. Grateful to be part of this chain of light.
            </div>
            
            <div class="destinations-grid">
                <div class="destination-item" onclick="sendDestinationMessage('New York')">
                    <img alt="New York" src="https://images.unsplash.com/photo-1496442226666-8d4d0e62e6e9?w=400&h=300&fit=crop"/>
                    <span>New York</span>
                </div>
                <div class="destination-item" onclick="sendDestinationMessage('Paris')">
                    <img alt="Paris" src="https://images.unsplash.com/photo-1500916434205-0c77489c6cf7?w=400&h=300&fit=crop"/>
                    <span>Paris</span>
                </div>
                <div class="destination-item" onclick="sendDestinationMessage('Tokyo')">
                    <img alt="Tokyo" src="https://images.unsplash.com/photo-1540959733332-eab4deabeeaf?w=400&h=300&fit=crop"/>
                    <span>Tokyo</span>
                </div>
                <div class="destination-item" onclick="sendDestinationMessage('Seoul')">
                    <img alt="Seoul" src="https://images.unsplash.com/photo-1549693578-d683be217e58?w=400&h=300&fit=crop"/>
                    <span>Seoul</span>
                </div>
                <div class="destination-item" onclick="sendDestinationMessage('London')">
                    <img alt="London" src="https://images.unsplash.com/photo-1513635269975-59663e0ac1ad?w=400&h=300&fit=crop"/>
                    <span>London</span>
                </div>
                <div class="destination-item" onclick="sendDestinationMessage('SÃ£o Paulo')">
                    <img alt="SÃ£o Paulo" src="https://images.unsplash.com/photo-1541781774459-bb2af2f05b55?w=400&h=300&fit=crop"/>
                    <span>SÃ£o Paulo</span>
                </div>
                <div class="destination-item" onclick="sendDestinationMessage('Dubai')">
                    <img alt="Dubai" src="https://images.unsplash.com/photo-1512453979798-5ea266f8880c?w=400&h=300&fit=crop"/>
                    <span>Dubai</span>
                </div>
                <div class="destination-item" onclick="sendDestinationMessage('Barcelona')">
                    <img alt="Barcelona" src="https://images.unsplash.com/photo-1539037116277-4db20889f2d4?w=400&h=300&fit=crop"/>
                    <span>Barcelona</span>
                </div>
                <div class="destination-item" onclick="sendDestinationMessage('Rome')">
                    <img alt="Rome" src="https://images.unsplash.com/photo-1531572753322-ad063cecc140?w=400&h=300&fit=crop"/>
                    <span>Rome</span>
                </div>
                <div class="destination-item" onclick="sendDestinationMessage('Sydney')">
                    <img alt="Sydney" src="https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400&h=300&fit=crop"/>
                    <span>Sydney</span>
                </div>
                <div class="destination-item" onclick="sendDestinationMessage('Bangkok')">
                    <img alt="Bangkok" src="https://images.unsplash.com/photo-1508009603885-50cf7c579365?w=400&h=300&fit=crop"/>
                    <span>Bangkok</span>
                </div>
                <div class="destination-item" onclick="sendDestinationMessage('Amsterdam')">
                    <img alt="Amsterdam" src="https://images.unsplash.com/photo-1534351590666-13e3e96b5017?w=400&h=300&fit=crop"/>
                    <span>Amsterdam</span>
                </div>
            </div>
            
            <div class="sidebar-footer" id="sidebarFooter">Connecting hearts to the world</div>
        </div>

        <div class="main">
            <div class="logo-container">
                <div class="logo">TPS</div>
            </div>

            <div class="header-tabs">
                <button class="tab-button active" id="flightsBtn">âœˆï¸ <span id="btnFlights">Flights</span></button>
                <button class="tab-button" id="hotelsBtn">ğŸ¨ <span id="btnHotels">Hotels</span></button>
                <button class="tab-button" id="transportBtn">ğŸš— <span id="btnTransport">Transport</span></button>
                <button class="tab-button" id="insuranceBtn">ğŸ›¡ï¸ <span id="btnInsurance">Insurance</span></button>
                <button class="tab-button" id="ticketsBtn">ğŸ« <span id="btnTickets">Tickets</span></button>
                <button class="tab-button" id="packagesBtn">ğŸ“¦ <span id="btnPackages">Packages</span></button>
            </div>

            <div class="chat-container" id="chatContainer">
            </div>
        </div>

        <div class="input-container">
            <textarea class="message-input" id="messageInput" placeholder="Tell me about your dream destination..." rows="1"></textarea>
            <button class="send-button" id="sendButton">
                <span id="sendButtonText">Send</span>
            </button>
        </div>
    </div>

    <script>
        // ============= MÃ“DULO TPS CULTURAL TEMPLATES COMPLETO (12 IDIOMAS) =============
        const TPSCulturalTemplates = {
            templates: {
                greeting: {
                    pt: {
                        icon: "ğŸŒŸ",
                        opening: "Seu coraÃ§Ã£o sussurrou um destino. Estou aqui para ouvi-lo.",
                        continuation: "A alma viajante desperta quando sente o chamado. Para onde ela aponta hoje?"
                    },
                    en: {
                        icon: "ğŸ—½",
                        opening: "Your spirit is calling for adventure. I'm here to help you answer that call.",
                        continuation: "Every great journey begins with a whisper from within. Where is yours leading you today?"
                    },
                    es: {
                        icon: "ğŸŒ…",
                        opening: "Tu alma susurra un destino. Estoy aquÃ­ para escuchar sus secretos.",
                        continuation: "Cada viaje nace de un deseo profundo. Â¿Hacia dÃ³nde te llama tu corazÃ³n aventurero?"
                    },
                    fr: {
                        icon: "âœ¨",
                        opening: "Votre Ã¢me murmure une destination. Je suis lÃ  pour Ã©couter ses secrets.",
                        continuation: "L'esprit voyageur s'Ã©veille quand il ressent l'appel de l'ailleurs. Vers oÃ¹ vous porte-t-il aujourd'hui?"
                    },
                    de: {
                        icon: "ğŸŒ ",
                        opening: "Ihr Herz flÃ¼stert ein Reiseziel. Ich bin hier, um zuzuhÃ¶ren.",
                        continuation: "Die Wanderseele erwacht, wenn sie den Ruf spÃ¼rt. Wohin zeigt sie heute?"
                    },
                    it: {
                        icon: "ğŸŒ¸",
                        opening: "Il tuo cuore sussurra una destinazione. Sono qui per ascoltarlo.",
                        continuation: "L'anima viaggiatrice si risveglia quando sente il richiamo. Dove punta oggi?"
                    },
                    ja: {
                        icon: "ğŸŒ¸",
                        opening: "ã‚ãªãŸã®å¿ƒãŒæ—…è·¯ã‚’å›ã„ã¦ã„ã¾ã™ã€‚é™å¯‚ã®ä¸­ã§ã€ãã®å£°ã«è€³ã‚’å‚¾ã‘ã¾ã—ã‚‡ã†ã€‚",
                        continuation: "é­‚ãŒæ±‚ã‚ã‚‹é“ãŒã‚ã‚Šã¾ã™ã€‚ã©ã¡ã‚‰ã¸å‘ã‹ã„ãŸã„ã¨ãŠæ„Ÿã˜ã§ã™ã‹ï¼Ÿ"
                    },
                    ko: {
                        icon: "ğŸŒ™",
                        opening: "ë§ˆìŒì† ê¹Šì€ ê³³ì—ì„œ ì—¬í–‰ì„ ë¶€ë¥´ê³  ìˆìŠµë‹ˆë‹¤. ê·¸ ëª©ì†Œë¦¬ë¥¼ í•¨ê»˜ ë“¤ì–´ë³´ê² ìŠµë‹ˆë‹¤.",
                        continuation: "ì˜í˜¼ì´ ì°¾ëŠ” ê¸¸ì´ ìˆìŠµë‹ˆë‹¤. ì˜¤ëŠ˜ì€ ì–´ë””ë¡œ í–¥í•˜ê³  ì‹¶ìœ¼ì‹ ê°€ìš”?"
                    },
                    zh: {
                        icon: "ğŸ®",
                        opening: "ä½ çš„å¿ƒåœ¨è½»å£°è¯‰è¯´ç€ä¸€ä¸ªç›®çš„åœ°ã€‚æˆ‘åœ¨è¿™é‡Œå€¾å¬å®ƒçš„ç§˜å¯†ã€‚",
                        continuation: "æ—…è¡Œçš„çµé­‚åœ¨æ„Ÿå—åˆ°å¬å”¤æ—¶è‹é†’ã€‚ä»Šå¤©å®ƒæŒ‡å‘å“ªé‡Œï¼Ÿ"
                    },
                    ru: {
                        icon: "â„ï¸",
                        opening: "Ğ’Ğ°ÑˆĞµ ÑĞµÑ€Ğ´Ñ†Ğµ ÑˆĞµĞ¿Ñ‡ĞµÑ‚ Ğ¾ Ğ¼ĞµÑÑ‚Ğµ Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ. Ğ¯ Ğ·Ğ´ĞµÑÑŒ, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ ÑƒÑĞ»Ñ‹ÑˆĞ°Ñ‚ÑŒ ĞµĞ³Ğ¾.",
                        continuation: "Ğ”ÑƒÑˆĞ° Ğ¿ÑƒÑ‚ĞµÑˆĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¸ĞºĞ° Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¶Ğ´Ğ°ĞµÑ‚ÑÑ, ĞºĞ¾Ğ³Ğ´Ğ° Ñ‡ÑƒĞ²ÑÑ‚Ğ²ÑƒĞµÑ‚ Ğ·Ğ¾Ğ². ĞšÑƒĞ´Ğ° Ğ¾Ğ½Ğ° ÑƒĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ?"
                    },
                    ar: {
                        icon: "ğŸŒ™",
                        opening: "Ù‚Ù„Ø¨Ùƒ ÙŠÙ‡Ù…Ø³ Ø¨ÙˆØ¬Ù‡Ø©. Ø£Ù†Ø§ Ù‡Ù†Ø§ Ù„Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ø¥Ù„ÙŠÙ‡.",
                        continuation: "Ø§Ù„Ø±ÙˆØ­ Ø§Ù„Ù…Ø³Ø§ÙØ±Ø© ØªØ³ØªÙŠÙ‚Ø¸ Ø¹Ù†Ø¯Ù…Ø§ ØªØ´Ø¹Ø± Ø¨Ø§Ù„Ù†Ø¯Ø§Ø¡. Ø¥Ù„Ù‰ Ø£ÙŠÙ† ØªØ´ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ØŸ"
                    },
                    hi: {
                        icon: "ğŸ•‰ï¸",
                        opening: "à¤†à¤ªà¤•à¤¾ à¤¦à¤¿à¤² à¤à¤• à¤—à¤‚à¤¤à¤µà¥à¤¯ à¤•à¥€ à¤«à¥à¤¸à¤«à¥à¤¸à¤¾à¤¹à¤Ÿ à¤•à¤° à¤°à¤¹à¤¾ à¤¹à¥ˆà¥¤ à¤®à¥ˆà¤‚ à¤‡à¤¸à¥‡ à¤¸à¥à¤¨à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤ à¤¯à¤¹à¤¾à¤ à¤¹à¥‚à¤à¥¤",
                        continuation: "à¤¯à¤¾à¤¤à¥à¤°à¥€ à¤†à¤¤à¥à¤®à¤¾ à¤œà¤¾à¤—à¤¤à¥€ à¤¹à¥ˆ à¤œà¤¬ à¤µà¤¹ à¤ªà¥à¤•à¤¾à¤° à¤®à¤¹à¤¸à¥‚à¤¸ à¤•à¤°à¤¤à¥€ à¤¹à¥ˆà¥¤ à¤†à¤œ à¤¯à¤¹ à¤•à¤¹à¤¾à¤ à¤‡à¤¶à¤¾à¤°à¤¾ à¤•à¤° à¤°à¤¹à¥€ à¤¹à¥ˆ?"
                    }
                },
                
                flightResults: {
                    pt: {
                        icon: "ğŸŒŸ",
                        opening: "Eis os caminhos possÃ­veis para sua jornada:",
                        flightPrefix: "âœˆï¸",
                        hotelPrefix: "ğŸ›ï¸",
                        hotelLabel: "Hospedagem sugerida:",
                        closing: "A travessia estÃ¡ revelada. Qual caminho chama sua alma?"
                    },
                    en: {
                        icon: "ğŸ—½",
                        opening: "Here are the paths to your adventure:",
                        flightPrefix: "âœˆï¸",
                        hotelPrefix: "ğŸ¨",
                        hotelLabel: "Recommended stay:",
                        closing: "Your journey awaits. Which path speaks to your heart?"
                    },
                    es: {
                        icon: "ğŸŒ…",
                        opening: "AquÃ­ estÃ¡n los caminos hacia tu aventura:",
                        flightPrefix: "âœˆï¸",
                        hotelPrefix: "ğŸ°",
                        hotelLabel: "Hospedaje sugerido:",
                        closing: "Tu viaje te espera. Â¿QuÃ© sendero habla a tu corazÃ³n?"
                    },
                    fr: {
                        icon: "âœ¨",
                        opening: "Voici les chemins qui s'ouvrent vers votre destination:",
                        flightPrefix: "âœˆï¸",
                        hotelPrefix: "ğŸ›ï¸",
                        hotelLabel: "HÃ©bergement suggÃ©rÃ©:",
                        closing: "Le destin vous propose ses routes. Laquelle rÃ©sonne avec votre Ãªtre?"
                    },
                    de: {
                        icon: "ğŸŒ ",
                        opening: "Hier sind die Wege zu Ihrem Abenteuer:",
                        flightPrefix: "âœˆï¸",
                        hotelPrefix: "ğŸ°",
                        hotelLabel: "Empfohlene Unterkunft:",
                        closing: "Ihre Reise wartet. Welcher Weg spricht zu Ihrem Herzen?"
                    },
                    it: {
                        icon: "ğŸŒ¸",
                        opening: "Ecco i percorsi verso la tua avventura:",
                        flightPrefix: "âœˆï¸",
                        hotelPrefix: "ğŸ›ï¸",
                        hotelLabel: "Soggiorno consigliato:",
                        closing: "Il tuo viaggio ti aspetta. Quale sentiero parla al tuo cuore?"
                    },
                    ja: {
                        icon: "ğŸŒ¸",
                        opening: "ã”æ—…è·¯ã¸ã®é“ç­‹ãŒè¦‹ãˆã¾ã—ãŸï¼š",
                        flightPrefix: "âœˆï¸",
                        hotelPrefix: "ğŸ®",
                        hotelLabel: "å®¿æ³Šã®ã”ææ¡ˆ:",
                        closing: "é“ã¯ç¤ºã•ã‚Œã¾ã—ãŸã€‚ã©ã¡ã‚‰ãŒã‚ãªãŸã®å¿ƒã«éŸ¿ãã¾ã™ã‹ï¼Ÿ"
                    },
                    ko: {
                        icon: "ğŸŒ™",
                        opening: "ì—¬í–‰ê¸¸ë¡œ í–¥í•˜ëŠ” ê¸¸ë“¤ì´ ë³´ì…ë‹ˆë‹¤ï¼š",
                        flightPrefix: "âœˆï¸",
                        hotelPrefix: "ğŸ¯",
                        hotelLabel: "ìˆ™ì†Œ ì œì•ˆ:",
                        closing: "ê¸¸ì´ ì—´ë ¸ìŠµë‹ˆë‹¤. ì–´ë–¤ ê¸¸ì´ ë§ˆìŒì— ì™€ ë‹¿ìœ¼ì‹œë‚˜ìš”?"
                    },
                    zh: {
                        icon: "ğŸ®",
                        opening: "è¿™é‡Œæ˜¯é€šå¾€ä½ å†’é™©çš„é“è·¯ï¼š",
                        flightPrefix: "âœˆï¸",
                        hotelPrefix: "ğŸ›ï¸",
                        hotelLabel: "æ¨èä½å®¿ï¼š",
                        closing: "ä½ çš„æ—…ç¨‹åœ¨ç­‰å¾…ã€‚å“ªæ¡è·¯å¾„ä¸ä½ çš„å¿ƒçµå¯¹è¯ï¼Ÿ"
                    },
                    ru: {
                        icon: "â„ï¸",
                        opening: "Ğ’Ğ¾Ñ‚ Ğ¿ÑƒÑ‚Ğ¸ Ğº Ğ²Ğ°ÑˆĞµĞ¼Ñƒ Ğ¿Ñ€Ğ¸ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ:",
                        flightPrefix: "âœˆï¸",
                        hotelPrefix: "ğŸ›ï¸",
                        hotelLabel: "Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµĞ¼Ğ¾Ğµ Ñ€Ğ°Ğ·Ğ¼ĞµÑ‰ĞµĞ½Ğ¸Ğµ:",
                        closing: "Ğ’Ğ°ÑˆĞµ Ğ¿ÑƒÑ‚ĞµÑˆĞµÑÑ‚Ğ²Ğ¸Ğµ Ğ¶Ğ´ĞµÑ‚. ĞšĞ°ĞºĞ¾Ğ¹ Ğ¿ÑƒÑ‚ÑŒ Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ¸Ñ‚ Ñ Ğ²Ğ°ÑˆĞ¸Ğ¼ ÑĞµÑ€Ğ´Ñ†ĞµĞ¼?"
                    },
                    ar: {
                        icon: "ğŸŒ™",
                        opening: "Ù‡Ø°Ù‡ Ù‡ÙŠ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª Ø¥Ù„Ù‰ Ù…ØºØ§Ù…Ø±ØªÙƒ:",
                        flightPrefix: "âœˆï¸",
                        hotelPrefix: "ğŸ›ï¸",
                        hotelLabel: "Ø§Ù„Ø¥Ù‚Ø§Ù…Ø© Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©:",
                        closing: "Ø±Ø­Ù„ØªÙƒ ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±. Ø£ÙŠ Ù…Ø³Ø§Ø± ÙŠØªØ­Ø¯Ø« Ø¥Ù„Ù‰ Ù‚Ù„Ø¨ÙƒØŸ"
                    },
                    hi: {
                        icon: "ğŸ•‰ï¸",
                        opening: "à¤¯à¤¹à¤¾à¤ à¤†à¤ªà¤•à¥‡ à¤¸à¤¾à¤¹à¤¸à¤¿à¤• à¤•à¤¾à¤°à¥à¤¯ à¤•à¥‡ à¤²à¤¿à¤ à¤°à¤¾à¤¸à¥à¤¤à¥‡ à¤¹à¥ˆà¤‚:",
                        flightPrefix: "âœˆï¸",
                        hotelPrefix: "ğŸ›ï¸",
                        hotelLabel: "à¤…à¤¨à¥à¤¶à¤‚à¤¸à¤¿à¤¤ à¤ªà¥à¤°à¤µà¤¾à¤¸:",
                        closing: "à¤†à¤ªà¤•à¥€ à¤¯à¤¾à¤¤à¥à¤°à¤¾ à¤ªà¥à¤°à¤¤à¥€à¤•à¥à¤·à¤¾ à¤•à¤° à¤°à¤¹à¥€ à¤¹à¥ˆà¥¤ à¤•à¥Œà¤¨ à¤¸à¤¾ à¤°à¤¾à¤¸à¥à¤¤à¤¾ à¤†à¤ªà¤•à¥‡ à¤¦à¤¿à¤² à¤¸à¥‡ à¤¬à¤¾à¤¤ à¤•à¤°à¤¤à¤¾ à¤¹à¥ˆ?"
                    }
                },
                
                fallback: {
                    pt: {
                        icon: "ğŸŒ«ï¸",
                        opening: "Ainda nÃ£o enxergo claramente o seu destino.",
                        explanation: "As nÃ©voas do tempo cobrem os caminhos, mas isso nÃ£o significa que eles nÃ£o existam. Poderia me contar com mais detalhes para onde sua alma deseja ir? Talvez uma data, uma cidade, ou mesmo apenas um sentimento?",
                        suggestion: "âœ¨ Enquanto isso, posso sugerir destinos que costumam chamar coraÃ§Ãµes inquietos..."
                    },
                    en: {
                        icon: "ğŸŒ«ï¸",
                        opening: "I can't quite see your destination clearly yet.",
                        explanation: "The mists of possibility are still settling, but that doesn't mean your path isn't there. Could you share more details about where your spirit wants to go? Maybe a date, a city, or even just a feeling you're chasing?",
                        suggestion: "ğŸ—½ Meanwhile, I can suggest destinations that call to restless hearts..."
                    },
                    es: {
                        icon: "ğŸŒ«ï¸",
                        opening: "AÃºn no veo claramente tu destino.",
                        explanation: "Las brumas del tiempo cubren los senderos, pero eso no significa que no existan. Â¿PodrÃ­as contarme mÃ¡s detalles sobre adÃ³nde quiere ir tu alma? Â¿QuizÃ¡s una fecha, una ciudad, o incluso solo un sentimiento?",
                        suggestion: "ğŸŒ… Mientras tanto, puedo sugerir destinos que suelen llamar a corazones inquietos..."
                    },
                    fr: {
                        icon: "ğŸŒ«ï¸",
                        opening: "Je ne distingue pas encore clairement votre destination.",
                        explanation: "Les brumes du temps voilent les chemins, mais cela ne signifie pas qu'ils n'existent pas. Pourriez-vous me confier plus de dÃ©tails sur l'endroit oÃ¹ votre Ã¢me souhaite aller? Peut-Ãªtre une date, une ville, ou mÃªme simplement un sentiment?",
                        suggestion: "âœ¨ En attendant, je peux suggÃ©rer des destinations qui appellent les cÅ“urs en quÃªte..."
                    },
                    de: {
                        icon: "ğŸŒ«ï¸",
                        opening: "Ich kann Ihr Ziel noch nicht klar erkennen.",
                        explanation: "Die Nebel der Zeit verhÃ¼llen die Wege, aber das bedeutet nicht, dass sie nicht existieren. KÃ¶nnten Sie mir mehr Details darÃ¼ber erzÃ¤hlen, wohin Ihre Seele gehen mÃ¶chte? Vielleicht ein Datum, eine Stadt oder sogar nur ein GefÃ¼hl?",
                        suggestion: "ğŸŒ  In der Zwischenzeit kann ich Reiseziele vorschlagen, die unruhige Herzen rufen..."
                    },
                    it: {
                        icon: "ğŸŒ«ï¸",
                        opening: "Non riesco ancora a vedere chiaramente la tua destinazione.",
                        explanation: "Le nebbie del tempo coprono i sentieri, ma questo non significa che non esistano. Potresti raccontarmi piÃ¹ dettagli su dove vuole andare la tua anima? Forse una data, una cittÃ , o anche solo un sentimento?",
                        suggestion: "ğŸŒ¸ Nel frattempo, posso suggerire destinazioni che di solito chiamano cuori inquieti..."
                    },
                    ja: {
                        icon: "ğŸŒ«ï¸",
                        opening: "ã¾ã ã‚ãªãŸã®ç›®çš„åœ°ãŒã¯ã£ãã‚Šã¨è¦‹ãˆã¾ã›ã‚“ã€‚",
                        explanation: "éœ§ãŒé“ç­‹ã‚’è¦†ã£ã¦ã„ã¾ã™ãŒã€é“ãŒå­˜åœ¨ã—ãªã„ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã‚‚ã†å°‘ã—è©³ã—ãæ•™ãˆã¦ã„ãŸã ã‘ã¾ã›ã‚“ã‹ï¼Ÿæ—¥ä»˜ã€éƒ½å¸‚ã€ã‚ã‚‹ã„ã¯ãŠæ°—æŒã¡ã ã‘ã§ã‚‚æ§‹ã„ã¾ã›ã‚“ã€‚",
                        suggestion: "ğŸŒ¸ ãã®é–“ã€è½ã¡ç€ã‹ãªã„å¿ƒã‚’å‘¼ã¶å ´æ‰€ã‚’ã”ææ¡ˆã§ãã¾ã™..."
                    },
                    ko: {
                        icon: "ğŸŒ«ï¸",
                        opening: "ì•„ì§ ëª©ì ì§€ê°€ ëª…í™•í•˜ê²Œ ë³´ì´ì§€ ì•ŠìŠµë‹ˆë‹¤.",
                        explanation: "ì‹œê°„ì˜ ì•ˆê°œê°€ ê¸¸ì„ ê°€ë¦¬ê³  ìˆì§€ë§Œ, ê¸¸ì´ ì—†ëŠ” ê²ƒì€ ì•„ë‹™ë‹ˆë‹¤. ë§ˆìŒì´ í–¥í•˜ê³ ì í•˜ëŠ” ê³³ì— ëŒ€í•´ ì¢€ ë” ìì„¸íˆ ë§ì”€í•´ ì£¼ì‹¤ ìˆ˜ ìˆë‚˜ìš”? ë‚ ì§œ, ë„ì‹œ, ë˜ëŠ” ë‹¨ìˆœí•œ ê°ì •ì´ë¼ë„ ê´œì°®ìŠµë‹ˆë‹¤.",
                        suggestion: "ğŸŒ™ ê·¸ë™ì•ˆ ë¶ˆì•ˆí•œ ë§ˆìŒì„ ë¶€ë¥´ëŠ” ê³³ë“¤ì„ ì œì•ˆí•´ ë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤..."
                    },
                    zh: {
                        icon: "ğŸŒ«ï¸",
                        opening: "æˆ‘è¿˜ä¸èƒ½æ¸…æ¥šåœ°çœ‹åˆ°ä½ çš„ç›®çš„åœ°ã€‚",
                        explanation: "æ—¶é—´çš„è¿·é›¾é®ç›–äº†é“è·¯ï¼Œä½†è¿™å¹¶ä¸æ„å‘³ç€å®ƒä»¬ä¸å­˜åœ¨ã€‚ä½ èƒ½å‘Šè¯‰æˆ‘æ›´å¤šå…³äºä½ çš„çµé­‚æƒ³å»å“ªé‡Œçš„ç»†èŠ‚å—ï¼Ÿä¹Ÿè®¸æ˜¯ä¸€ä¸ªæ—¥æœŸã€ä¸€åº§åŸå¸‚ï¼Œç”šè‡³åªæ˜¯ä¸€ç§æ„Ÿè§‰ï¼Ÿ",
                        suggestion: "ğŸ® ä¸æ­¤åŒæ—¶ï¼Œæˆ‘å¯ä»¥å»ºè®®ä¸€äº›é€šå¸¸å‘¼å”¤ä¸å®‰å¿ƒçµçš„ç›®çš„åœ°..."
                    },
                    ru: {
                        icon: "ğŸŒ«ï¸",
                        opening: "Ğ¯ ĞµÑ‰Ğµ Ğ½Ğµ Ğ¼Ğ¾Ğ³Ñƒ ÑÑĞ½Ğ¾ Ğ²Ğ¸Ğ´ĞµÑ‚ÑŒ Ğ²Ğ°ÑˆĞµ Ğ¼ĞµÑÑ‚Ğ¾ Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ.",
                        explanation: "Ğ¢ÑƒĞ¼Ğ°Ğ½Ñ‹ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ ÑĞºÑ€Ñ‹Ğ²Ğ°ÑÑ‚ Ğ¿ÑƒÑ‚Ğ¸, Ğ½Ğ¾ ÑÑ‚Ğ¾ Ğ½Ğµ Ğ¾Ğ·Ğ½Ğ°Ñ‡Ğ°ĞµÑ‚, Ñ‡Ñ‚Ğ¾ Ğ¸Ñ… Ğ½Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚. ĞĞµ Ğ¼Ğ¾Ğ³Ğ»Ğ¸ Ğ±Ñ‹ Ğ²Ñ‹ Ñ€Ğ°ÑÑĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ¼Ğ½Ğµ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ğ´ĞµÑ‚Ğ°Ğ»ĞµĞ¹ Ğ¾ Ñ‚Ğ¾Ğ¼, ĞºÑƒĞ´Ğ° Ñ…Ğ¾Ñ‡ĞµÑ‚ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒÑÑ Ğ²Ğ°ÑˆĞ° Ğ´ÑƒÑˆĞ°? Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾, Ğ´Ğ°Ñ‚Ñƒ, Ğ³Ğ¾Ñ€Ğ¾Ğ´ Ğ¸Ğ»Ğ¸ Ğ´Ğ°Ğ¶Ğµ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ Ñ‡ÑƒĞ²ÑÑ‚Ğ²Ğ¾?",
                        suggestion: "â„ï¸ Ğ¢ĞµĞ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½ĞµĞ¼ Ñ Ğ¼Ğ¾Ğ³Ñƒ Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶Ğ¸Ñ‚ÑŒ Ğ¼ĞµÑÑ‚Ğ°, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ğ¾ Ğ·Ğ¾Ğ²ÑƒÑ‚ Ğ±ĞµÑĞ¿Ğ¾ĞºĞ¾Ğ¹Ğ½Ñ‹Ğµ ÑĞµÑ€Ğ´Ñ†Ğ°..."
                    },
                    ar: {
                        icon: "ğŸŒ«ï¸",
                        opening: "Ù„Ø§ Ø£Ø³ØªØ·ÙŠØ¹ Ø±Ø¤ÙŠØ© ÙˆØ¬Ù‡ØªÙƒ Ø¨ÙˆØ¶ÙˆØ­ Ø¨Ø¹Ø¯.",
                        explanation: "Ø¶Ø¨Ø§Ø¨ Ø§Ù„Ø²Ù…Ù† ÙŠØºØ·ÙŠ Ø§Ù„Ù…Ø³Ø§Ø±Ø§ØªØŒ Ù„ÙƒÙ† Ù‡Ø°Ø§ Ù„Ø§ ÙŠØ¹Ù†ÙŠ Ø£Ù†Ù‡Ø§ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©. Ù‡Ù„ ÙŠÙ…ÙƒÙ†Ùƒ Ø£Ù† ØªØ®Ø¨Ø±Ù†ÙŠ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø­ÙˆÙ„ Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯ Ø±ÙˆØ­Ùƒ Ø§Ù„Ø°Ù‡Ø§Ø¨ Ø¥Ù„ÙŠÙ‡ØŸ Ø±Ø¨Ù…Ø§ ØªØ§Ø±ÙŠØ®ØŒ Ù…Ø¯ÙŠÙ†Ø©ØŒ Ø£Ùˆ Ø­ØªÙ‰ Ù…Ø¬Ø±Ø¯ Ø´Ø¹ÙˆØ±ØŸ",
                        suggestion: "ğŸŒ™ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø«Ù†Ø§Ø¡ØŒ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ø§Ù‚ØªØ±Ø§Ø­ ÙˆØ¬Ù‡Ø§Øª ØªØ³ØªØ¯Ø¹ÙŠ Ø¹Ø§Ø¯Ø© Ø§Ù„Ù‚Ù„ÙˆØ¨ Ø§Ù„Ù‚Ù„Ù‚Ø©..."
                    },
                    hi: {
                        icon: "ğŸŒ«ï¸",
                        opening: "à¤®à¥ˆà¤‚ à¤…à¤­à¥€ à¤­à¥€ à¤†à¤ªà¤•à¥‡ à¤—à¤‚à¤¤à¤µà¥à¤¯ à¤•à¥‹ à¤¸à¥à¤ªà¤·à¥à¤Ÿ à¤°à¥‚à¤ª à¤¸à¥‡ à¤¨à¤¹à¥€à¤‚ à¤¦à¥‡à¤– à¤¸à¤•à¤¤à¤¾à¥¤",
                        explanation: "à¤¸à¤®à¤¯ à¤•à¥€ à¤§à¥à¤‚à¤§ à¤°à¤¾à¤¸à¥à¤¤à¥‹à¤‚ à¤•à¥‹ à¤¢à¤• à¤¦à¥‡à¤¤à¥€ à¤¹à¥ˆ, à¤²à¥‡à¤•à¤¿à¤¨ à¤‡à¤¸à¤•à¤¾ à¤®à¤¤à¤²à¤¬ à¤¯à¤¹ à¤¨à¤¹à¥€à¤‚ à¤¹à¥ˆ à¤•à¤¿ à¤µà¥‡ à¤®à¥Œà¤œà¥‚à¤¦ à¤¨à¤¹à¥€à¤‚ à¤¹à¥ˆà¤‚à¥¤ à¤•à¥à¤¯à¤¾ à¤†à¤ª à¤®à¥à¤à¥‡ à¤‡à¤¸ à¤¬à¤¾à¤°à¥‡ à¤®à¥‡à¤‚ à¤”à¤° à¤µà¤¿à¤µà¤°à¤£ à¤¬à¤¤à¤¾ à¤¸à¤•à¤¤à¥‡ à¤¹à¥ˆà¤‚ à¤•à¤¿ à¤†à¤ªà¤•à¥€ à¤†à¤¤à¥à¤®à¤¾ à¤•à¤¹à¤¾à¤ à¤œà¤¾à¤¨à¤¾ à¤šà¤¾à¤¹à¤¤à¥€ à¤¹à¥ˆ? à¤¶à¤¾à¤¯à¤¦ à¤à¤• à¤¤à¤¾à¤°à¥€à¤–, à¤à¤• à¤¶à¤¹à¤°, à¤¯à¤¾ à¤•à¥‡à¤µà¤² à¤à¤• à¤­à¤¾à¤µà¤¨à¤¾?",
                        suggestion: "ğŸ•‰ï¸ à¤‡à¤¸ à¤¬à¥€à¤š, à¤®à¥ˆà¤‚ à¤‰à¤¨ à¤—à¤‚à¤¤à¤µà¥à¤¯à¥‹à¤‚ à¤•à¤¾ à¤¸à¥à¤à¤¾à¤µ à¤¦à¥‡ à¤¸à¤•à¤¤à¤¾ à¤¹à¥‚à¤ à¤œà¥‹ à¤†à¤®à¤¤à¥Œà¤° à¤ªà¤° à¤¬à¥‡à¤šà¥ˆà¤¨ à¤¦à¤¿à¤²à¥‹à¤‚ à¤•à¥‹ à¤¬à¥à¤²à¤¾à¤¤à¥‡ à¤¹à¥ˆà¤‚..."
                    }
                }
            },
            
            getTemplate(type, lang = 'en') {
                const fallbackLang = this.templates[type][lang] ? lang : 'en';
                return this.templates[type][fallbackLang] || {};
            },
            
            renderGreeting(lang = 'en') {
                const template = this.getTemplate('greeting', lang);
                return `${template.icon} ${template.opening}\n\n${template.continuation}`;
            },
            
            renderFallback(lang = 'en') {
                const template = this.getTemplate('fallback', lang);
                return `${template.icon} ${template.opening}\n\n${template.explanation}\n\n${template.suggestion}`;
            }
        };

        // ============= SISTEMA MULTILÃNGUE COMPLETO (12 IDIOMAS) =============
        let currentLang = 'en';
        let isProcessing = false;

        const translations = {
            en: {
                languageTitle: "ğŸŒ Language / Idioma",
                sidebarTitle: "ğŸ§­ Destinations that Touch the Soul",
                sidebarMessage: "ğŸŒ± Every journey through TPS plants hope and transforms lives. Grateful to be part of this chain of light.",
                sidebarFooter: "Connecting hearts to the world",
                btnFlights: "Flights",
                btnHotels: "Hotels", 
                btnTransport: "Transport",
                btnInsurance: "Insurance",
                btnTickets: "Tickets",
                btnPackages: "Packages",
                placeholder: "Tell me about your dream destination...",
                send: "Send",
                you: "You",
                assistant: "TPS Assistant"
            },
            pt: {
                languageTitle: "ğŸŒ Idioma / Language",
                sidebarTitle: "ğŸ§­ Destinos que Tocam a Alma",
                sidebarMessage: "ğŸŒ± Cada jornada pelo TPS planta esperanÃ§a e transforma vidas. Grato por fazer parte desta corrente de luz.",
                sidebarFooter: "Conectando coraÃ§Ãµes ao mundo",
                btnFlights: "Voos",
                btnHotels: "HotÃ©is",
                btnTransport: "Transporte", 
                btnInsurance: "Seguro",
                btnTickets: "Ingressos",
                btnPackages: "Pacotes",
                placeholder: "Compartilhe seus sonhos de viagem...",
                send: "Enviar",
                you: "VocÃª",
                assistant: "TPS Assistant"
            },
            es: {
                languageTitle: "ğŸŒ Idioma / Language",
                sidebarTitle: "ğŸ§­ Destinos que Tocan el Alma",
                sidebarMessage: "ğŸŒ± Cada viaje a travÃ©s de TPS planta esperanza y transforma vidas. Agradecido de ser parte de esta cadena de luz.",
                sidebarFooter: "Conectando corazones con el mundo",
                btnFlights: "Vuelos",
                btnHotels: "Hoteles",
                btnTransport: "Transporte",
                btnInsurance: "Seguro",
                btnTickets: "Entradas",
                btnPackages: "Paquetes",
                placeholder: "CuÃ©ntame sobre tu destino soÃ±ado...",
                send: "Enviar",
                you: "TÃº",
                assistant: "TPS Assistant"
            },
            fr: {
                languageTitle: "ğŸŒ Langue / Language",
                sidebarTitle: "ğŸ§­ Destinations qui Touchent l'Ã‚me",
                sidebarMessage: "ğŸŒ± Chaque voyage avec TPS plante l'espoir et transforme les vies. Reconnaissant de faire partie de cette chaÃ®ne de lumiÃ¨re.",
                sidebarFooter: "Connecter les cÅ“urs au monde",
                btnFlights: "Vols",
                btnHotels: "HÃ´tels",
                btnTransport: "Transport",
                btnInsurance: "Assurance",
                btnTickets: "Billets",
                btnPackages: "Forfaits",
                placeholder: "Parlez-moi de votre destination de rÃªve...",
                send: "Envoyer",
                you: "Vous",
                assistant: "TPS Assistant"
            },
            de: {
                languageTitle: "ğŸŒ Sprache / Language",
                sidebarTitle: "ğŸ§­ Reiseziele die die Seele BerÃ¼hren",
                sidebarMessage: "ğŸŒ± Jede Reise mit TPS pflanzt Hoffnung und verwandelt Leben. Dankbar, Teil dieser Lichtkette zu sein.",
                sidebarFooter: "Herzen mit der Welt verbinden",
                btnFlights: "FlÃ¼ge",
                btnHotels: "Hotels",
                btnTransport: "Transport",
                btnInsurance: "Versicherung",
                btnTickets: "Tickets",
                btnPackages: "Pakete",
                placeholder: "ErzÃ¤hlen Sie mir von Ihrem Traumziel...",
                send: "Senden",
                you: "Sie",
                assistant: "TPS Assistant"
            },
            it: {
                languageTitle: "ğŸŒ Lingua / Language",
                sidebarTitle: "ğŸ§­ Destinazioni che Toccano l'Anima",
                sidebarMessage: "ğŸŒ± Ogni viaggio con TPS pianta speranza e trasforma vite. Grato di far parte di questa catena di luce.",
                sidebarFooter: "Collegare cuori al mondo",
                btnFlights: "Voli",
                btnHotels: "Hotel",
                btnTransport: "Trasporto",
                btnInsurance: "Assicurazione",
                btnTickets: "Biglietti",
                btnPackages: "Pacchetti",
                placeholder: "Parlami della tua destinazione dei sogni...",
                send: "Invia",
                you: "Tu",
                assistant: "TPS Assistant"
            },
            ja: {
                languageTitle: "ğŸŒ è¨€èª / Language",
                sidebarTitle: "ğŸ§­ å¿ƒã«è§¦ã‚Œã‚‹ç›®çš„åœ°",
                sidebarMessage: "ğŸŒ± TPSã§ã®æ—…ã¯ã™ã¹ã¦å¸Œæœ›ã‚’æ¤ãˆã€äººç”Ÿã‚’å¤‰ãˆã¾ã™ã€‚ã“ã®å…‰ã®é€£é–ã®ä¸€éƒ¨ã§ã‚ã‚‹ã“ã¨ã«æ„Ÿè¬ã—ã¦ã„ã¾ã™ã€‚",
                sidebarFooter: "å¿ƒã‚’ä¸–ç•Œã«ã¤ãªã",
                btnFlights: "èˆªç©ºåˆ¸",
                btnHotels: "ãƒ›ãƒ†ãƒ«",
                btnTransport: "äº¤é€š",
                btnInsurance: "ä¿é™º",
                btnTickets: "ãƒã‚±ãƒƒãƒˆ",
                btnPackages: "ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸",
                placeholder: "å¤¢ã®ç›®çš„åœ°ã«ã¤ã„ã¦æ•™ãˆã¦ãã ã•ã„...",
                send: "é€ä¿¡",
                you: "ã‚ãªãŸ",
                assistant: "TPS ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ"
            },
            ko: {
                languageTitle: "ğŸŒ ì–¸ì–´ / Language",
                sidebarTitle: "ğŸ§­ ì˜í˜¼ì— ë‹¿ëŠ” ì—¬í–‰ì§€",
                sidebarMessage: "ğŸŒ± TPSë¥¼ í†µí•œ ëª¨ë“  ì—¬í–‰ì€ í¬ë§ì„ ì‹¬ê³  ì‚¶ì„ ë³€í™”ì‹œí‚µë‹ˆë‹¤. ì´ ë¹›ì˜ ì‚¬ìŠ¬ì˜ ì¼ë¶€ê°€ ë˜ì–´ ê°ì‚¬í•©ë‹ˆë‹¤.",
                sidebarFooter: "ë§ˆìŒì„ ì„¸ìƒê³¼ ì—°ê²°í•˜ê¸°",
                btnFlights: "í•­ê³µí¸",
                btnHotels: "í˜¸í…”",
                btnTransport: "êµí†µ",
                btnInsurance: "ë³´í—˜",
                btnTickets: "í‹°ì¼“",
                btnPackages: "íŒ¨í‚¤ì§€",
                placeholder: "ê¿ˆì˜ ëª©ì ì§€ì— ëŒ€í•´ ë§í•´ì£¼ì„¸ìš”...",
                send: "ì „ì†¡",
                you: "ë‹¹ì‹ ",
                assistant: "TPS ì–´ì‹œìŠ¤í„´íŠ¸"
            },
            zh: {
                languageTitle: "ğŸŒ è¯­è¨€ / Language",
                sidebarTitle: "ğŸ§­ è§¦åŠ¨å¿ƒçµçš„ç›®çš„åœ°",
                sidebarMessage: "ğŸŒ± é€šè¿‡TPSçš„æ¯ä¸€æ¬¡æ—…è¡Œéƒ½æ’­ä¸‹å¸Œæœ›å¹¶æ”¹å˜ç”Ÿæ´»ã€‚æ„Ÿè°¢æˆä¸ºè¿™å…‰æ˜ä¹‹é“¾çš„ä¸€éƒ¨åˆ†ã€‚",
                sidebarFooter: "è¿æ¥å¿ƒçµä¸ä¸–ç•Œ",
                btnFlights: "èˆªç­",
                btnHotels: "é…’åº—",
                btnTransport: "äº¤é€š",
                btnInsurance: "ä¿é™©",
                btnTickets: "é—¨ç¥¨",
                btnPackages: "å¥—é¤",
                placeholder: "å‘Šè¯‰æˆ‘ä½ æ¢¦æƒ³çš„ç›®çš„åœ°...",
                send: "å‘é€",
                you: "æ‚¨",
                assistant: "TPS åŠ©æ‰‹"
            },
            ru: {
                languageTitle: "ğŸŒ Ğ¯Ğ·Ñ‹Ğº / Language",
                sidebarTitle: "ğŸ§­ ĞœĞµÑÑ‚Ğ°, Ğ¢Ñ€Ğ¾Ğ³Ğ°ÑÑ‰Ğ¸Ğµ Ğ”ÑƒÑˆÑƒ",
                sidebarMessage: "ğŸŒ± ĞšĞ°Ğ¶Ğ´Ğ¾Ğµ Ğ¿ÑƒÑ‚ĞµÑˆĞµÑÑ‚Ğ²Ğ¸Ğµ Ñ‡ĞµÑ€ĞµĞ· TPS ÑĞµĞµÑ‚ Ğ½Ğ°Ğ´ĞµĞ¶Ğ´Ñƒ Ğ¸ Ğ¼ĞµĞ½ÑĞµÑ‚ Ğ¶Ğ¸Ğ·Ğ½Ğ¸. Ğ‘Ğ»Ğ°Ğ³Ğ¾Ğ´Ğ°Ñ€ĞµĞ½ Ğ±Ñ‹Ñ‚ÑŒ Ñ‡Ğ°ÑÑ‚ÑŒÑ ÑÑ‚Ğ¾Ğ¹ Ñ†ĞµĞ¿Ğ¸ ÑĞ²ĞµÑ‚Ğ°.",
                sidebarFooter: "Ğ¡Ğ¾ĞµĞ´Ğ¸Ğ½ÑÑ ÑĞµÑ€Ğ´Ñ†Ğ° Ñ Ğ¼Ğ¸Ñ€Ğ¾Ğ¼",
                btnFlights: "ĞĞ²Ğ¸Ğ°Ğ±Ğ¸Ğ»ĞµÑ‚Ñ‹",
                btnHotels: "ĞÑ‚ĞµĞ»Ğ¸",
                btnTransport: "Ğ¢Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚",
                btnInsurance: "Ğ¡Ñ‚Ñ€Ğ°Ñ…Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ",
                btnTickets: "Ğ‘Ğ¸Ğ»ĞµÑ‚Ñ‹",
                btnPackages: "ĞŸĞ°ĞºĞµÑ‚Ñ‹",
                placeholder: "Ğ Ğ°ÑÑĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ Ğ¾ Ğ¼ĞµÑÑ‚Ğµ Ğ²Ğ°ÑˆĞµĞ¹ Ğ¼ĞµÑ‡Ñ‚Ñ‹...",
                send: "ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ",
                you: "Ğ’Ñ‹",
                assistant: "TPS ĞÑÑĞ¸ÑÑ‚ĞµĞ½Ñ‚"
            },
            ar: {
                languageTitle: "ğŸŒ Ø§Ù„Ù„ØºØ© / Language",
                sidebarTitle: "ğŸ§­ ÙˆØ¬Ù‡Ø§Øª ØªÙ„Ø§Ù…Ø³ Ø§Ù„Ø±ÙˆØ­",
                sidebarMessage: "ğŸŒ± ÙƒÙ„ Ø±Ø­Ù„Ø© Ø¹Ø¨Ø± TPS ØªØ²Ø±Ø¹ Ø§Ù„Ø£Ù…Ù„ ÙˆØªØºÙŠØ± Ø§Ù„Ø­ÙŠØ§Ø©. Ù…Ù…ØªÙ† Ù„ÙƒÙˆÙ†ÙŠ Ø¬Ø²Ø¡Ù‹Ø§ Ù…Ù† Ø³Ù„Ø³Ù„Ø© Ø§Ù„Ù†ÙˆØ± Ù‡Ø°Ù‡.",
                sidebarFooter: "Ø±Ø¨Ø· Ø§Ù„Ù‚Ù„ÙˆØ¨ Ø¨Ø§Ù„Ø¹Ø§Ù„Ù…",
                btnFlights: "Ø·ÙŠØ±Ø§Ù†",
                btnHotels: "ÙÙ†Ø§Ø¯Ù‚",
                btnTransport: "Ù†Ù‚Ù„",
                btnInsurance: "ØªØ£Ù…ÙŠÙ†",
                btnTickets: "ØªØ°Ø§ÙƒØ±",
                btnPackages: "Ø­Ø²Ù…",
                placeholder: "Ø£Ø®Ø¨Ø±Ù†ÙŠ Ø¹Ù† ÙˆØ¬Ù‡Ø© Ø£Ø­Ù„Ø§Ù…Ùƒ...",
                send: "Ø¥Ø±Ø³Ø§Ù„",
                you: "Ø£Ù†Øª",
                assistant: "Ù…Ø³Ø§Ø¹Ø¯ TPS"
            },
            hi: {
                languageTitle: "ğŸŒ à¤­à¤¾à¤·à¤¾ / Language",
                sidebarTitle: "ğŸ§­ à¤†à¤¤à¥à¤®à¤¾ à¤•à¥‹ à¤›à¥‚à¤¨à¥‡ à¤µà¤¾à¤²à¥‡ à¤—à¤‚à¤¤à¤µà¥à¤¯",
                sidebarMessage: "ğŸŒ± TPS à¤•à¥‡ à¤®à¤¾à¤§à¥à¤¯à¤® à¤¸à¥‡ à¤¹à¤° à¤¯à¤¾à¤¤à¥à¤°à¤¾ à¤†à¤¶à¤¾ à¤¬à¥‹à¤¤à¥€ à¤¹à¥ˆ à¤”à¤° à¤œà¥€à¤µà¤¨ à¤•à¥‹ à¤¬à¤¦à¤²à¤¤à¥€ à¤¹à¥ˆà¥¤ à¤‡à¤¸ à¤ªà¥à¤°à¤•à¤¾à¤¶ à¤¶à¥à¤°à¥ƒà¤‚à¤–à¤²à¤¾ à¤•à¤¾ à¤¹à¤¿à¤¸à¥à¤¸à¤¾ à¤¹à¥‹à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤ à¤†à¤­à¤¾à¤°à¥€à¥¤",
                sidebarFooter: "à¤¦à¤¿à¤²à¥‹à¤‚ à¤•à¥‹ à¤¦à¥à¤¨à¤¿à¤¯à¤¾ à¤¸à¥‡ à¤œà¥‹à¤¡à¤¼à¤¨à¤¾",
                btnFlights: "à¤‰à¤¡à¤¼à¤¾à¤¨à¥‡à¤‚",
                btnHotels: "à¤¹à¥‹à¤Ÿà¤²",
                btnTransport: "à¤ªà¤°à¤¿à¤µà¤¹à¤¨",
                btnInsurance: "à¤¬à¥€à¤®à¤¾",
                btnTickets: "à¤Ÿà¤¿à¤•à¤Ÿ",
                btnPackages: "à¤ªà¥ˆà¤•à¥‡à¤œ",
                placeholder: "à¤…à¤ªà¤¨à¥‡ à¤¸à¤ªà¤¨à¥‹à¤‚ à¤•à¥‡ à¤—à¤‚à¤¤à¤µà¥à¤¯ à¤•à¥‡ à¤¬à¤¾à¤°à¥‡ à¤®à¥‡à¤‚ à¤¬à¤¤à¤¾à¤à¤‚...",
                send: "à¤­à¥‡à¤œà¥‡à¤‚",
                you: "à¤†à¤ª",
                assistant: "TPS à¤…à¤¸à¤¿à¤¸à¥à¤Ÿà¥‡à¤‚à¤Ÿ"
            }
        };

        // ============= SISTEMA DE AFILIADOS CORRIGIDO E COMPLETO =============
        const afiliadosReais = {
            voos: [
                {
                    nome: "WayAway",
                    url: "https://tp.media/r?marker=639764&trs=425649&p=5976&u=https%3A%2F%2Fwayaway.io&campaign_id=200",
                    prioridade: 1
                },
                {
                    nome: "Trip.com",
                    url: "https://tp.media/r?marker=639764&trs=425649&p=8626&u=https%3A%2F%2Ftrip.com&campaign_id=121",
                    prioridade: 2
                },
                {
                    nome: "Aviasales",
                    url: "https://tp.media/r?marker=639764&trs=425649&p=4114&u=https%3A%2F%2Faviasales.com&campaign_id=100",
                    prioridade: 3
                }
            ],
            hoteis: [
                {
                    nome: "Trip.com Hotels",
                    url: "https://tp.media/r?marker=639764&trs=425649&p=8626&u=https%3A%2F%2Ftrip.com%2Fhotels&campaign_id=121",
                    prioridade: 1
                },
                {
                    nome: "Booking.com",
                    url: "https://www.awin1.com/cread.php?awinmid=18119&awinaffid=1949091&ued=https%3A%2F%2Fwww.booking.com%2Findex.html",
                    prioridade: 2
                }
            ],
            transporte: [
                {
                    nome: "Localrent",
                    url: "https://tp.media/r?marker=639764&trs=425649&p=2043&u=https%3A%2F%2Flocalrent.com%2Fen&campaign_id=87",
                    prioridade: 1
                },
                {
                    nome: "Kiwitaxi", 
                    url: "https://tp.media/r?marker=639764&trs=425649&p=647&u=https%3A%2F%2Fkiwitaxi.com&campaign_id=1",
                    prioridade: 2
                }
            ],
            insurance: [
                {
                    nome: "EKTA Travel",
                    url: "https://tp.media/r?marker=639764&trs=425649&p=5869&u=https%3A%2F%2Fektatraveling.com&campaign_id=225",
                    prioridade: 1
                },
                {
                    nome: "Compare Insurance",
                    url: "https://www.awin1.com/cread.php?awinmid=80595&awinaffid=1949091&ued=https%3A%2F%2Fquote.compareyourtravelinsurance.co.uk%2F",
                    prioridade: 2
                }
            ],
            tickets: [
                {
                    nome: "Tiqets",
                    url: "https://tp.media/r?marker=639764&trs=425649&p=2074&u=https%3A%2F%2Ftiqets.com&campaign_id=89",
                    prioridade: 1
                },
                {
                    nome: "WeGoTrip",
                    url: "https://tp.media/r?marker=639764&trs=425649&p=4487&u=https%3A%2F%2Fwegotrip.com&campaign_id=150",
                    prioridade: 2
                }
            ],
            packages: [
                {
                    nome: "Kiwi.com",
                    url: "https://tp.media/click?shmarker=639764&promo_id=3413&source_type=link&type=click&campaign_id=111&trs=425649",
                    prioridade: 1
                },
                {
                    nome: "WayAway Plus",
                    url: "https://tp.media/r?marker=639764&trs=425649&p=5976&u=https%3A%2F%2Fwayaway.io%2Fplus&campaign_id=200",
                    prioridade: 2
                }
            ]
        };

        // ============= FUNÃ‡Ã•ES PRINCIPAIS =============
        
        function detectLanguageFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const langParam = urlParams.get('lang');
            
            console.log('ğŸ” URL atual:', window.location.href);
            console.log('ğŸŒ ParÃ¢metro lang detectado:', langParam);
            
            if (langParam && translations[langParam]) {
                console.log('âœ… Idioma VÃLIDO da URL:', langParam);
                return langParam;
            }
            
            const savedLang = localStorage.getItem('tps_language');
            if (savedLang && translations[savedLang]) {
                console.log('ğŸ’¾ Idioma do localStorage:', savedLang);
                return savedLang;
            }
            
            const browserLang = navigator.language.substring(0, 2);
            if (translations[browserLang]) {
                console.log('ğŸŒ Idioma do navegador:', browserLang);
                return browserLang;
            }
            
            console.log('ğŸ”„ Usando idioma padrÃ£o: en');
            return 'en';
        }

        function applyTranslations(lang) {
            console.log('ğŸ”„ Aplicando traduÃ§Ãµes para idioma:', lang);
            
            const texts = translations[lang];
            if (!texts) {
                console.error('âŒ TraduÃ§Ãµes nÃ£o encontradas para:', lang);
                return;
            }
            
            const elementMappings = {
                'languageTitle': texts.languageTitle,
                'sidebarTitle': texts.sidebarTitle,
                'sidebarMessage': texts.sidebarMessage,
                'sidebarFooter': texts.sidebarFooter,
                'btnFlights': texts.btnFlights,
                'btnHotels': texts.btnHotels,
                'btnTransport': texts.btnTransport,
                'btnInsurance': texts.btnInsurance,
                'btnTickets': texts.btnTickets,
                'btnPackages': texts.btnPackages,
                'sendButtonText': texts.send
            };
            
            Object.entries(elementMappings).forEach(([elementId, translation]) => {
                const element = document.getElementById(elementId);
                if (element) {
                    element.textContent = translation;
                    console.log(`âœ… ${elementId}: ${translation}`);
                }
            });
            
            const messageInput = document.getElementById('messageInput');
            if (messageInput) {
                messageInput.placeholder = texts.placeholder;
                console.log('âœ… Placeholder atualizado:', texts.placeholder);
            }
            
            const languageSelect = document.getElementById('languageSelect');
            if (languageSelect) {
                languageSelect.value = lang;
                console.log('âœ… Seletor sincronizado com:', lang);
            }
            
            localStorage.setItem('tps_language', lang);
            console.log('ğŸ’¾ Idioma salvo no localStorage:', lang);
        }

        function changeLanguage(newLang) {
            console.log('ğŸ”„ Mudando idioma para:', newLang);
            
            currentLang = newLang;
            applyTranslations(newLang);
            
            const url = new URL(window.location);
            url.searchParams.set('lang', newLang);
            window.history.replaceState({}, '', url);
            
            console.log('ğŸ†• URL atualizada:', url.toString());
        }

        function addMessage(text, isUser = false) {
            const chatContainer = document.getElementById('chatContainer');
            if (!chatContainer) return;
            
            // Processar links de afiliados se for resposta da IA
            if (!isUser) {
                text = addAffiliateLinksToText(text);
            }
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'conversation-line ' + (isUser ? 'user' : 'assistant');
            
            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.textContent = isUser ? 'U' : 'T';
            
            const content = document.createElement('div');
            content.className = 'message-content';
            
            const header = document.createElement('div');
            header.className = 'message-header';
            const texts = translations[currentLang] || translations['en'];
            header.textContent = isUser ? texts.you : texts.assistant;
            
            const textDiv = document.createElement('div');
            textDiv.className = 'message-text';
            textDiv.innerHTML = text.replace(/\n/g, '<br>').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            
            content.appendChild(header);
            content.appendChild(textDiv);
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(content);
            
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function addAffiliateLinksToText(text) {
            if (!text) return text;
            
            // Detectar preÃ§os e tornÃ¡-los clicÃ¡veis
            let processedText = text.replace(
                /(\$\s?\d+[,.]?\d*|\â‚¬\s?\d+[,.]?\d*|R\$\s?\d+[,.]?\d*|USD\s*\d+[,.]?\d*|EUR\s*\d+[,.]?\d*)/gi,
                (match) => {
                    const affiliate = afiliadosReais.voos[0];
                    return `<a href="${affiliate.url}" target="_blank" style="color: white; text-decoration: none; font-weight: bold; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 4px 8px; border-radius: 8px; margin: 0 2px; display: inline-block;">${match}</a>`;
                }
            );
            
            return processedText;
        }

        function sendDestinationMessage(destination) {
            // Usar template cultural baseado no idioma atual
            const greeting = TPSCulturalTemplates.renderGreeting(currentLang);
            const message = `${greeting}\n\nâœˆï¸ Destino escolhido: ${destination}`;
            addMessage(message);
            
            // Simular processamento
            setTimeout(() => {
                const response = generateDestinationResponse(destination, currentLang);
                addMessage(response);
            }, 1500);
        }

        function generateDestinationResponse(destination, lang) {
            const template = TPSCulturalTemplates.getTemplate('flightResults', lang);
            
            // Simular dados de voo
            const mockFlights = [
                {
                    airline: 'LATAM',
                    route: `GRU â†’ ${destination}`,
                    time: '22:10 â†’ 12:00',
                    class: 'Executiva',
                    price: 'USD 1.430'
                },
                {
                    airline: 'Air France',
                    route: `GRU â†’ ${destination}`,
                    time: '16:20 â†’ 09:15',
                    class: 'EconÃ´mica',
                    price: 'USD 980'
                }
            ];
            
            let response = `${template.icon} ${template.opening}\n\n`;
            
            mockFlights.forEach(flight => {
                response += `${template.flightPrefix} ${flight.airline} | ${flight.route} | ${flight.time} | ${flight.class} | ${flight.price}\n`;
            });
            
            response += `\n${template.hotelPrefix} ${template.hotelLabel} Hotel Alma ${destination} â€“ USD 180/noite\n\n${template.closing}`;
            
            return response;
        }

        async function sendMessage() {
            if (isProcessing) return;
            
            const messageInput = document.getElementById('messageInput');
            const sendButton = document.getElementById('sendButton');
            
            if (!messageInput || !sendButton) return;
            
            const userMessage = messageInput.value.trim();
            if (!userMessage) return;

            isProcessing = true;
            sendButton.disabled = true;
            sendButton.innerHTML = '<span>...</span>';

            addMessage(userMessage, true);
            messageInput.value = '';

            try {
                console.log('ğŸš€ Enviando para API GPT real...', {
                    message: userMessage,
                    language: currentLang
                });
                
                // Criar contexto com instruÃ§Ãµes especÃ­ficas para o idioma
                const languageNames = {
                    'en': 'English',
                    'pt': 'Portuguese (Brazilian)',
                    'es': 'Spanish', 
                    'fr': 'French',
                    'de': 'German',
                    'it': 'Italian',
                    'ja': 'Japanese',
                    'ko': 'Korean',
                    'zh': 'Chinese (Simplified)',
                    'ru': 'Russian',
                    'ar': 'Arabic',
                    'hi': 'Hindi'
                };
                
                const contextualMessage = `User message: "${userMessage}"

CRITICAL INSTRUCTIONS:
- RESPOND ONLY IN ${languageNames[currentLang] || 'English'} (language code: ${currentLang})
- You are TPS, a mystical travel oracle with poetic and symbolic responses
- Include specific flight prices (USD format) and hotel suggestions
- Use symbolic language like "your soul calls for..." or "the path reveals..."
- Format prices as: USD 1,250 or EUR 180 (these become clickable affiliate links)
- Always include a spiritual/emotional call-to-action
- Mention real airlines like LATAM, Air France, Emirates when suggesting flights
- Keep the mystical tone while providing practical travel information

Current user language: ${currentLang}
Response language: ${languageNames[currentLang] || 'English'}`;
                
                const response = await fetch("https://tps-railway-api-production.up.railway.app/gpt-tps", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "x-api-key": "canal-vivo-tps-2025"
                    },
                    body: JSON.stringify({
                        message: contextualMessage,
                        language: currentLang,
                        cultural_template: true,
                        timestamp: Date.now()
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    console.log('âœ… Resposta da API:', data);
                    
                    // Extrair resposta real do GPT
                    let gptResponse = data.content || data.reply?.message || data.message;
                    
                    if (!gptResponse || typeof gptResponse !== 'string') {
                        throw new Error('Resposta invÃ¡lida da API');
                    }
                    
                    // Verificar se a resposta estÃ¡ no idioma correto
                    console.log('ğŸ“ Resposta do GPT:', gptResponse.substring(0, 100) + '...');
                    
                    addMessage(gptResponse);
                } else {
                    throw new Error(`API Error: ${response.status} ${response.statusText}`);
                }

            } catch (error) {
                console.error('âŒ Erro na API:', error);
                // Usar fallback cultural em vez de mensagem genÃ©rica
                const fallbackResponse = TPSCulturalTemplates.renderFallback(currentLang);
                addMessage(fallbackResponse);
            } finally {
                // Reativar interface
                isProcessing = false;
                sendButton.disabled = false;
                const texts = translations[currentLang] || translations['en'];
                sendButton.innerHTML = '<span>' + texts.send + '</span>';
            }
        }

        function setupAffiliateButtons() {
            const buttonMappings = {
                'flightsBtn': () => {
                    window.open(afiliadosReais.voos[0].url, '_blank');
                    trackAffiliateClick('voos', afiliadosReais.voos[0].nome);
                },
                'hotelsBtn': () => {
                    window.open(afiliadosReais.hoteis[0].url, '_blank');
                    trackAffiliateClick('hoteis', afiliadosReais.hoteis[0].nome);
                },
                'transportBtn': () => {
                    window.open(afiliadosReais.transporte[0].url, '_blank');
                    trackAffiliateClick('transporte', afiliadosReais.transporte[0].nome);
                },
                'insuranceBtn': () => {
                    window.open(afiliadosReais.insurance[0].url, '_blank');
                    trackAffiliateClick('insurance', afiliadosReais.insurance[0].nome);
                },
                'ticketsBtn': () => {
                    window.open(afiliadosReais.tickets[0].url, '_blank');
                    trackAffiliateClick('tickets', afiliadosReais.tickets[0].nome);
                },
                'packagesBtn': () => {
                    window.open(afiliadosReais.packages[0].url, '_blank');
                    trackAffiliateClick('packages', afiliadosReais.packages[0].nome);
                }
            };
            
            Object.entries(buttonMappings).forEach(([buttonId, action]) => {
                const button = document.getElementById(buttonId);
                if (button) {
                    button.addEventListener('click', action);
                }
            });
            
            console.log('âœ… Todos os botÃµes de afiliados configurados');
        }

        function trackAffiliateClick(category, partner) {
            const clickData = {
                category,
                partner,
                timestamp: Date.now(),
                language: currentLang,
                url: window.location.href
            };
            
            // Salvar no localStorage
            const clicks = JSON.parse(localStorage.getItem('tps_affiliate_clicks') || '[]');
            clicks.push(clickData);
            localStorage.setItem('tps_affiliate_clicks', JSON.stringify(clicks.slice(-50)));
            
            console.log('ğŸ“Š Clique de afiliado registrado:', clickData);
            
            // Mostrar feedback ao usuÃ¡rio
            const texts = translations[currentLang] || translations['en'];
            const partnerName = partner || category;
            addMessage(`ğŸ”— Redirecionando para ${partnerName}...`);
        }

        // ============= INICIALIZAÃ‡ÃƒO COMPLETA =============
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸŒ TPS inicializando com sistema cultural completo (12 idiomas)...');
            
            // 1. Detectar e aplicar idioma
            currentLang = detectLanguageFromURL();
            console.log('ğŸ¯ Idioma detectado:', currentLang);
            applyTranslations(currentLang);
            
            // 2. Configurar event listeners
            const messageInput = document.getElementById('messageInput');
            const sendButton = document.getElementById('sendButton');
            const languageSelect = document.getElementById('languageSelect');
            
            if (sendButton) {
                sendButton.addEventListener('click', sendMessage);
            }
            
            if (messageInput) {
                messageInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        sendMessage();
                    }
                });
            }

            if (languageSelect) {
                languageSelect.addEventListener('change', function(e) {
                    changeLanguage(e.target.value);
                });
            }

            // 3. Configurar sistema de afiliados COMPLETO
            setupAffiliateButtons();

            // 4. Mensagem de boas-vindas cultural
            setTimeout(() => {
                const greeting = TPSCulturalTemplates.renderGreeting(currentLang);
                addMessage(greeting);
                console.log('ğŸ’¬ SaudaÃ§Ã£o cultural em:', currentLang);
            }, 1000);
            
            console.log(`âœ… TPS inicializado completamente`);
            console.log(`ğŸŒ Idioma: ${currentLang} | Sistema Cultural: 12 idiomas ativos`);
            console.log(`ğŸ”— Afiliados: ${Object.keys(afiliadosReais).length} categorias configuradas`);
        });

        // Tornar funÃ§Ã£o disponÃ­vel globalmente
        window.sendDestinationMessage = sendDestinationMessage;

        // Debug e estatÃ­sticas
        console.log('ğŸ“Š TPS Cultural System Completo:', {
            idiomas_suportados: Object.keys(translations).length,
            templates_culturais: Object.keys(TPSCulturalTemplates.templates).length,
            afiliados_categorias: Object.keys(afiliadosReais).length,
            total_links_afiliados: Object.values(afiliadosReais).reduce((acc, arr) => acc + arr.length, 0)
        });
    </script>
</body>
</html>
                        